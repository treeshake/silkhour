(()=>{"use strict";let t={};function i(i,n){return void 0===t[i]&&(t[i]=[]),t[i]=[...t[i],n],function(){t[i]=t[i].filter((t=>t!==n))}}class n extends HTMLElement{constructor(){super(),this.quantityForm=null,this.cartUpdateUnsubscriber=void 0,this.variantChangeUnsubscriber=void 0,this.input=this.querySelector(".quantity__input"),this.currentVariant=this.querySelector(".product-variant-id"),this.submitButton=this.querySelector('[type="submit"]')}connectedCallback(){this.input&&(this.quantityForm=this.querySelector(".product-form__quantity"),this.quantityForm&&(this.setQuantityBoundries(),this.dataset.originalSection||(this.cartUpdateUnsubscriber=i("cart-update",this.fetchQuantityRules.bind(this))),this.variantChangeUnsubscriber=i("variant-change",(t=>{const i=this.dataset.originalSection?this.dataset.originalSection:this.dataset.section;t.data.sectionId===i&&(this.updateQuantityRules(t.data.sectionId,t.data.html),this.setQuantityBoundries())}))))}disconnectedCallback(){this.cartUpdateUnsubscriber&&this.cartUpdateUnsubscriber(),this.variantChangeUnsubscriber&&this.variantChangeUnsubscriber()}setQuantityBoundries(){var i,n,e,a,s;const r={cartQuantity:(null===(i=this.input)||void 0===i?void 0:i.dataset.cartQuantity)?parseInt(this.input.dataset.cartQuantity):0,min:(null===(n=this.input)||void 0===n?void 0:n.dataset.min)?parseInt(this.input.dataset.min):1,max:(null===(e=this.input)||void 0===e?void 0:e.dataset.max)?parseInt(this.input.dataset.max):null,step:(null===(a=this.input)||void 0===a?void 0:a.step)?parseInt(this.input.step):1};let u=r.min;const o=null===r.max?r.max:r.max-r.cartQuantity;var c;null!==o&&(u=Math.min(u,o)),r.cartQuantity>=r.min&&(u=Math.min(u,r.step)),this.input.min=u,o?this.input.max=o:null===(s=this.input)||void 0===s||s.removeAttribute("max"),this.input.value=u,t[c="quantity-update"]&&t[c].forEach((t=>{t(void 0)}))}fetchQuantityRules(){var t;this.currentVariant&&this.currentVariant.value&&(null===(t=this.querySelector(".quantity__rules-cart .loading__spinner"))||void 0===t||t.classList.remove("hidden"),fetch(`${this.dataset.url}?variant=${this.currentVariant.value}&section_id=${this.dataset.section}`).then((t=>t.text())).then((t=>{const i=(new DOMParser).parseFromString(t,"text/html");this.updateQuantityRules(this.dataset.section,i),this.setQuantityBoundries()})).catch((t=>{console.error(t)})).finally((()=>{var t;null===(t=this.querySelector(".quantity__rules-cart .loading__spinner"))||void 0===t||t.classList.add("hidden")})))}updateQuantityRules(t,i){var n;const e=i.getElementById(`Quantity-Form-${t}`),a=[".quantity__input",".quantity__rules",".quantity__label"];for(let t of a){const i=null===(n=this.quantityForm)||void 0===n?void 0:n.querySelector(t),a=e.querySelector(t);if(i&&a)if(".quantity__input"===t){const t=["data-cart-quantity","data-min","data-max","step"];for(let n of t){const t=a.getAttribute(n);null!==t?i.setAttribute(n,t):i.removeAttribute(n)}}else i.innerHTML=a.innerHTML}}}customElements.get("custom-product-info")||customElements.define("custom-product-info",n)})();