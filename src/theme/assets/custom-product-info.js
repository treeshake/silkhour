(()=>{"use strict";let t={};function i(i,n){return void 0===t[i]&&(t[i]=[]),t[i]=[...t[i],n],function(){t[i]=t[i].filter((t=>t!==n))}}class n extends HTMLElement{constructor(){super(),this.quantityForm=null,this.cartUpdateUnsubscriber=void 0,this.variantChangeUnsubscriber=void 0,this.input=this.querySelector(".quantity__input"),this.currentVariant=this.querySelector(".product-variant-id"),this.submitButton=this.querySelector('[type="submit"]')}connectedCallback(){console.log("Connected callback"),this.input&&(this.quantityForm=this.querySelector(".product-form__quantity"),this.quantityForm&&(this.setQuantityBoundries(),this.dataset.originalSection||(this.cartUpdateUnsubscriber=i("cart-update",this.fetchQuantityRules.bind(this))),this.variantChangeUnsubscriber=i("variant-change",(t=>{const i=this.dataset.originalSection?this.dataset.originalSection:this.dataset.section;t.data.sectionId===i&&(this.updateQuantityRules(t.data.sectionId,t.data.html),this.setQuantityBoundries())}))))}disconnectedCallback(){this.cartUpdateUnsubscriber&&this.cartUpdateUnsubscriber(),this.variantChangeUnsubscriber&&this.variantChangeUnsubscriber()}setQuantityBoundries(){var i,n,e,a,s;const r={cartQuantity:(null===(i=this.input)||void 0===i?void 0:i.dataset.cartQuantity)?parseInt(this.input.dataset.cartQuantity):0,min:(null===(n=this.input)||void 0===n?void 0:n.dataset.min)?parseInt(this.input.dataset.min):1,max:(null===(e=this.input)||void 0===e?void 0:e.dataset.max)?parseInt(this.input.dataset.max):null,step:(null===(a=this.input)||void 0===a?void 0:a.step)?parseInt(this.input.step):1};let u=r.min;const o=null===r.max?r.max:r.max-r.cartQuantity;var c;null!==o&&(u=Math.min(u,o)),r.cartQuantity>=r.min&&(u=Math.min(u,r.step)),this.input.min=u,o?this.input.max=o:null===(s=this.input)||void 0===s||s.removeAttribute("max"),this.input.value=u,t[c="quantity-update"]&&t[c].forEach((t=>{t(void 0)}))}fetchQuantityRules(){var t;this.currentVariant&&this.currentVariant.value&&(null===(t=this.querySelector(".quantity__rules-cart .loading__spinner"))||void 0===t||t.classList.remove("hidden"),fetch(`${this.dataset.url}?variant=${this.currentVariant.value}&section_id=${this.dataset.section}`).then((t=>t.text())).then((t=>{const i=(new DOMParser).parseFromString(t,"text/html");this.updateQuantityRules(this.dataset.section,i),this.setQuantityBoundries()})).catch((t=>{console.error(t)})).finally((()=>{var t;null===(t=this.querySelector(".quantity__rules-cart .loading__spinner"))||void 0===t||t.classList.add("hidden")})))}updateQuantityRules(t,i){var n;const e=i.getElementById(`Quantity-Form-${t}`),a=[".quantity__input",".quantity__rules",".quantity__label"];for(let t of a){const i=null===(n=this.quantityForm)||void 0===n?void 0:n.querySelector(t),a=e.querySelector(t);if(i&&a)if(".quantity__input"===t){const t=["data-cart-quantity","data-min","data-max","step"];for(let n of t){const t=a.getAttribute(n);null!==t?i.setAttribute(n,t):i.removeAttribute(n)}}else i.innerHTML=a.innerHTML}}}customElements.get("custom-product-info")||customElements.define("custom-product-info",n)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LEtBQUtHLGVBQWV3QixvQkFBb0IzQixLQUFLUyxRQUFRTSxXQUVuRmtCLE1BQU1DLEdBQ0VBLEVBQVNDLFNBRWpCRixNQUFNRyxJQUNMLE1BQU1sQixHQUFPLElBQUltQixXQUFZQyxnQkFBZ0JGLEVBQWMsYUFDM0RwQyxLQUFLaUIsb0JBQW9CakIsS0FBS1MsUUFBUU0sUUFBU0csR0FDL0NsQixLQUFLUSxzQkFBc0IsSUFFNUIrQixPQUFPQyxJQUNObEMsUUFBUW1DLE1BQU1ELEVBQUUsSUFFakJFLFNBQVEsSyxNQUdOLFFBRkQsRUFBQTFDLEtBQUtFLGNBQ0gsa0RBQ0QsU0FBRTJCLFVBQVVjLElBQUksU0FBUyxJQUVoQyxDQUVBLG1CQUFBMUIsQ0FBb0JILEVBQWdCSSxHLE1BQ2xDLE1BQU0wQixFQUFzQjFCLEVBQUsyQixlQUMvQixpQkFBaUIvQixLQUViZ0MsRUFBWSxDQUNoQixtQkFDQSxtQkFDQSxvQkFFRixJQUFLLElBQUlDLEtBQVlELEVBQVcsQ0FDOUIsTUFBTUUsRUFBMkIsUUFBakIsRUFBQWhELEtBQUtILG9CQUFZLGVBQUVLLGNBQWM2QyxHQUMzQ0UsRUFBVUwsRUFBb0IxQyxjQUFjNkMsR0FDbEQsR0FBS0MsR0FBWUMsRUFDakIsR0FBaUIscUJBQWJGLEVBQWlDLENBQ25DLE1BQU1HLEVBQWEsQ0FDakIscUJBQ0EsV0FDQSxXQUNBLFFBRUYsSUFBSyxJQUFJQyxLQUFhRCxFQUFZLENBQ2hDLE1BQU1FLEVBQWVILEVBQVFJLGFBQWFGLEdBQ3JCLE9BQWpCQyxFQUNGSixFQUFRTSxhQUFhSCxFQUFXQyxHQUVoQ0osRUFBUXRCLGdCQUFnQnlCLEVBRTVCLENBQ0YsTUFDRUgsRUFBUU8sVUFBWU4sRUFBUU0sU0FFaEMsQ0FDRixFQUdHQyxlQUFlQyxJQUFJLHdCQUN0QkQsZUFBZUUsT0FBTyxzQkFBdUJqRSxFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGFiLWNvbmNpZXJnZS8uL3NyYy90cy9wdWJzdWIudHMiLCJ3ZWJwYWNrOi8vbGFiLWNvbmNpZXJnZS8uL3NyYy90cy9Qcm9kdWN0SW5mby50cyIsIndlYnBhY2s6Ly9sYWItY29uY2llcmdlLy4vc3JjL3RzL2NvbnN0YW50cy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcGllZCBhbmQgYWRhcHRlZCBmcm9tIFNwb3RsaWdodCBcbiAqIEBzZWUgcHVic3ViLmpzXG4qKi8gXG5cbmxldCBzdWJzY3JpYmVyczogYW55ID0ge307XG5cbmV4cG9ydCBmdW5jdGlvbiBzdWJzY3JpYmUoXG4gIGV2ZW50TmFtZTogc3RyaW5nLFxuICBjYWxsYmFjazogKGRhdGE6IHVua25vd24pID0+IHZvaWQsXG4pIHtcbiAgaWYgKHN1YnNjcmliZXJzW2V2ZW50TmFtZV0gPT09IHVuZGVmaW5lZCkge1xuICAgIHN1YnNjcmliZXJzW2V2ZW50TmFtZV0gPSBbXTtcbiAgfVxuXG4gIHN1YnNjcmliZXJzW2V2ZW50TmFtZV0gPSBbLi4uc3Vic2NyaWJlcnNbZXZlbnROYW1lXSwgY2FsbGJhY2tdO1xuXG4gIHJldHVybiBmdW5jdGlvbiB1bnN1YnNjcmliZSgpIHtcbiAgICBzdWJzY3JpYmVyc1tldmVudE5hbWVdID0gc3Vic2NyaWJlcnNbZXZlbnROYW1lXS5maWx0ZXIoKGNiOiBhbnkpID0+IHtcbiAgICAgIHJldHVybiBjYiAhPT0gY2FsbGJhY2s7XG4gICAgfSk7XG4gIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwdWJsaXNoKGV2ZW50TmFtZTogc3RyaW5nLCBkYXRhOiB1bmtub3duKSB7XG4gIGlmIChzdWJzY3JpYmVyc1tldmVudE5hbWVdKSB7XG4gICAgc3Vic2NyaWJlcnNbZXZlbnROYW1lXS5mb3JFYWNoKChjYWxsYmFjazogKGRhdGE6IGFueSkgPT4gdm9pZCkgPT4ge1xuICAgICAgY2FsbGJhY2soZGF0YSk7XG4gICAgfSk7XG4gIH1cbn1cbiIsImltcG9ydCB7IFBVQl9TVUJfRVZFTlRTIH0gZnJvbSAnLi9jb25zdGFudHMnO1xuaW1wb3J0IHsgcHVibGlzaCwgc3Vic2NyaWJlIH0gZnJvbSAnLi9wdWJzdWInO1xuXG4vKipcbiAqIENvcGllZCBhbmQgYWRhcHRlZCBmcm9tIFNwb3RsaWdodCBcbiAqIEBzZWUgcHJvZHVjdC1pbmZvLmpzXG4qKi8gXG5leHBvcnQgY2xhc3MgUHJvZHVjdEluZm8gZXh0ZW5kcyBIVE1MRWxlbWVudCB7XG4gIGlucHV0OiBIVE1MRm9ybUVsZW1lbnQgfCBudWxsO1xuICBjdXJyZW50VmFyaWFudDogSFRNTEZvcm1FbGVtZW50IHwgbnVsbDtcbiAgc3VibWl0QnV0dG9uOiBIVE1MRm9ybUVsZW1lbnQgfCBudWxsO1xuICBxdWFudGl0eUZvcm06IEhUTUxGb3JtRWxlbWVudCB8IG51bGwgPSBudWxsO1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5pbnB1dCA9IHRoaXMucXVlcnlTZWxlY3RvcignLnF1YW50aXR5X19pbnB1dCcpO1xuICAgIHRoaXMuY3VycmVudFZhcmlhbnQgPSB0aGlzLnF1ZXJ5U2VsZWN0b3IoJy5wcm9kdWN0LXZhcmlhbnQtaWQnKTtcbiAgICB0aGlzLnN1Ym1pdEJ1dHRvbiA9IHRoaXMucXVlcnlTZWxlY3RvcignW3R5cGU9XCJzdWJtaXRcIl0nKTtcbiAgfVxuXG4gIGNhcnRVcGRhdGVVbnN1YnNjcmliZXI/OiAoKSA9PiB2b2lkID0gdW5kZWZpbmVkO1xuICB2YXJpYW50Q2hhbmdlVW5zdWJzY3JpYmVyPzogKCkgPT4gdm9pZCA9IHVuZGVmaW5lZDtcblxuICBjb25uZWN0ZWRDYWxsYmFjaygpIHtcbiAgICBjb25zb2xlLmxvZyhgQ29ubmVjdGVkIGNhbGxiYWNrYCk7XG4gICAgaWYgKCF0aGlzLmlucHV0KSByZXR1cm47XG4gICAgdGhpcy5xdWFudGl0eUZvcm0gPSB0aGlzLnF1ZXJ5U2VsZWN0b3IoJy5wcm9kdWN0LWZvcm1fX3F1YW50aXR5Jyk7XG4gICAgaWYgKCF0aGlzLnF1YW50aXR5Rm9ybSkgcmV0dXJuO1xuICAgIHRoaXMuc2V0UXVhbnRpdHlCb3VuZHJpZXMoKTtcbiAgICBpZiAoIXRoaXMuZGF0YXNldC5vcmlnaW5hbFNlY3Rpb24pIHtcbiAgICAgIHRoaXMuY2FydFVwZGF0ZVVuc3Vic2NyaWJlciA9IHN1YnNjcmliZShcbiAgICAgICAgUFVCX1NVQl9FVkVOVFMuY2FydFVwZGF0ZSxcbiAgICAgICAgdGhpcy5mZXRjaFF1YW50aXR5UnVsZXMuYmluZCh0aGlzKSxcbiAgICAgICk7XG4gICAgfVxuICAgIHRoaXMudmFyaWFudENoYW5nZVVuc3Vic2NyaWJlciA9IHN1YnNjcmliZShcbiAgICAgIFBVQl9TVUJfRVZFTlRTLnZhcmlhbnRDaGFuZ2UsXG4gICAgICAoZXZlbnQ6IGFueSkgPT4ge1xuICAgICAgICBjb25zdCBzZWN0aW9uSWQgPSB0aGlzLmRhdGFzZXQub3JpZ2luYWxTZWN0aW9uXG4gICAgICAgICAgPyB0aGlzLmRhdGFzZXQub3JpZ2luYWxTZWN0aW9uXG4gICAgICAgICAgOiB0aGlzLmRhdGFzZXQuc2VjdGlvbjtcbiAgICAgICAgaWYgKGV2ZW50LmRhdGEuc2VjdGlvbklkICE9PSBzZWN0aW9uSWQpIHJldHVybjtcbiAgICAgICAgdGhpcy51cGRhdGVRdWFudGl0eVJ1bGVzKGV2ZW50LmRhdGEuc2VjdGlvbklkLCBldmVudC5kYXRhLmh0bWwpO1xuICAgICAgICB0aGlzLnNldFF1YW50aXR5Qm91bmRyaWVzKCk7XG4gICAgICB9LFxuICAgICk7XG4gIH1cblxuICBkaXNjb25uZWN0ZWRDYWxsYmFjaygpIHtcbiAgICBpZiAodGhpcy5jYXJ0VXBkYXRlVW5zdWJzY3JpYmVyKSB7XG4gICAgICB0aGlzLmNhcnRVcGRhdGVVbnN1YnNjcmliZXIoKTtcbiAgICB9XG4gICAgaWYgKHRoaXMudmFyaWFudENoYW5nZVVuc3Vic2NyaWJlcikge1xuICAgICAgdGhpcy52YXJpYW50Q2hhbmdlVW5zdWJzY3JpYmVyKCk7XG4gICAgfVxuICB9XG5cbiAgc2V0UXVhbnRpdHlCb3VuZHJpZXMoKSB7XG4gICAgY29uc3QgZGF0YSA9IHtcbiAgICAgIGNhcnRRdWFudGl0eTogdGhpcy5pbnB1dD8uZGF0YXNldC5jYXJ0UXVhbnRpdHlcbiAgICAgICAgPyBwYXJzZUludCh0aGlzLmlucHV0LmRhdGFzZXQuY2FydFF1YW50aXR5KVxuICAgICAgICA6IDAsXG4gICAgICBtaW46IHRoaXMuaW5wdXQ/LmRhdGFzZXQubWluID8gcGFyc2VJbnQodGhpcy5pbnB1dC5kYXRhc2V0Lm1pbikgOiAxLFxuICAgICAgbWF4OiB0aGlzLmlucHV0Py5kYXRhc2V0Lm1heCA/IHBhcnNlSW50KHRoaXMuaW5wdXQuZGF0YXNldC5tYXgpIDogbnVsbCxcbiAgICAgIHN0ZXA6IHRoaXMuaW5wdXQ/LnN0ZXAgPyBwYXJzZUludCh0aGlzLmlucHV0LnN0ZXApIDogMSxcbiAgICB9O1xuXG4gICAgbGV0IG1pbiA9IGRhdGEubWluO1xuICAgIGNvbnN0IG1heCA9IGRhdGEubWF4ID09PSBudWxsID8gZGF0YS5tYXggOiBkYXRhLm1heCAtIGRhdGEuY2FydFF1YW50aXR5O1xuICAgIGlmIChtYXggIT09IG51bGwpIG1pbiA9IE1hdGgubWluKG1pbiwgbWF4KTtcbiAgICBpZiAoZGF0YS5jYXJ0UXVhbnRpdHkgPj0gZGF0YS5taW4pIG1pbiA9IE1hdGgubWluKG1pbiwgZGF0YS5zdGVwKTtcbiAgICB0aGlzLmlucHV0IS5taW4gPSBtaW47XG5cbiAgICBpZiAobWF4KSB7XG4gICAgICB0aGlzLmlucHV0IS5tYXggPSBtYXg7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuaW5wdXQ/LnJlbW92ZUF0dHJpYnV0ZSgnbWF4Jyk7XG4gICAgfVxuICAgIHRoaXMuaW5wdXQhLnZhbHVlID0gbWluO1xuICAgIHB1Ymxpc2goUFVCX1NVQl9FVkVOVFMucXVhbnRpdHlVcGRhdGUsIHVuZGVmaW5lZCk7XG4gIH1cblxuICBmZXRjaFF1YW50aXR5UnVsZXMoKSB7XG4gICAgaWYgKCF0aGlzLmN1cnJlbnRWYXJpYW50IHx8ICF0aGlzLmN1cnJlbnRWYXJpYW50LnZhbHVlKSByZXR1cm47XG4gICAgdGhpcy5xdWVyeVNlbGVjdG9yKFxuICAgICAgJy5xdWFudGl0eV9fcnVsZXMtY2FydCAubG9hZGluZ19fc3Bpbm5lcicsXG4gICAgKT8uY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7XG4gICAgZmV0Y2goXG4gICAgICBgJHt0aGlzLmRhdGFzZXQudXJsfT92YXJpYW50PSR7dGhpcy5jdXJyZW50VmFyaWFudC52YWx1ZX0mc2VjdGlvbl9pZD0ke3RoaXMuZGF0YXNldC5zZWN0aW9ufWAsXG4gICAgKVxuICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgIHJldHVybiByZXNwb25zZS50ZXh0KCk7XG4gICAgICB9KVxuICAgICAgLnRoZW4oKHJlc3BvbnNlVGV4dCkgPT4ge1xuICAgICAgICBjb25zdCBodG1sID0gbmV3IERPTVBhcnNlcigpLnBhcnNlRnJvbVN0cmluZyhyZXNwb25zZVRleHQsICd0ZXh0L2h0bWwnKTtcbiAgICAgICAgdGhpcy51cGRhdGVRdWFudGl0eVJ1bGVzKHRoaXMuZGF0YXNldC5zZWN0aW9uLCBodG1sKTtcbiAgICAgICAgdGhpcy5zZXRRdWFudGl0eUJvdW5kcmllcygpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaCgoZSkgPT4ge1xuICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xuICAgICAgfSlcbiAgICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgICAgdGhpcy5xdWVyeVNlbGVjdG9yKFxuICAgICAgICAgICcucXVhbnRpdHlfX3J1bGVzLWNhcnQgLmxvYWRpbmdfX3NwaW5uZXInLFxuICAgICAgICApPy5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTtcbiAgICAgIH0pO1xuICB9XG5cbiAgdXBkYXRlUXVhbnRpdHlSdWxlcyhzZWN0aW9uSWQ6IGFueSwgaHRtbDogYW55KSB7XG4gICAgY29uc3QgcXVhbnRpdHlGb3JtVXBkYXRlZCA9IGh0bWwuZ2V0RWxlbWVudEJ5SWQoXG4gICAgICBgUXVhbnRpdHktRm9ybS0ke3NlY3Rpb25JZH1gLFxuICAgICk7XG4gICAgY29uc3Qgc2VsZWN0b3JzID0gW1xuICAgICAgJy5xdWFudGl0eV9faW5wdXQnLFxuICAgICAgJy5xdWFudGl0eV9fcnVsZXMnLFxuICAgICAgJy5xdWFudGl0eV9fbGFiZWwnLFxuICAgIF07XG4gICAgZm9yIChsZXQgc2VsZWN0b3Igb2Ygc2VsZWN0b3JzKSB7XG4gICAgICBjb25zdCBjdXJyZW50ID0gdGhpcy5xdWFudGl0eUZvcm0/LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpO1xuICAgICAgY29uc3QgdXBkYXRlZCA9IHF1YW50aXR5Rm9ybVVwZGF0ZWQucXVlcnlTZWxlY3RvcihzZWxlY3Rvcik7XG4gICAgICBpZiAoIWN1cnJlbnQgfHwgIXVwZGF0ZWQpIGNvbnRpbnVlO1xuICAgICAgaWYgKHNlbGVjdG9yID09PSAnLnF1YW50aXR5X19pbnB1dCcpIHtcbiAgICAgICAgY29uc3QgYXR0cmlidXRlcyA9IFtcbiAgICAgICAgICAnZGF0YS1jYXJ0LXF1YW50aXR5JyxcbiAgICAgICAgICAnZGF0YS1taW4nLFxuICAgICAgICAgICdkYXRhLW1heCcsXG4gICAgICAgICAgJ3N0ZXAnLFxuICAgICAgICBdO1xuICAgICAgICBmb3IgKGxldCBhdHRyaWJ1dGUgb2YgYXR0cmlidXRlcykge1xuICAgICAgICAgIGNvbnN0IHZhbHVlVXBkYXRlZCA9IHVwZGF0ZWQuZ2V0QXR0cmlidXRlKGF0dHJpYnV0ZSk7XG4gICAgICAgICAgaWYgKHZhbHVlVXBkYXRlZCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgY3VycmVudC5zZXRBdHRyaWJ1dGUoYXR0cmlidXRlLCB2YWx1ZVVwZGF0ZWQpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjdXJyZW50LnJlbW92ZUF0dHJpYnV0ZShhdHRyaWJ1dGUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY3VycmVudC5pbm5lckhUTUwgPSB1cGRhdGVkLmlubmVySFRNTDtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cblxuaWYgKCFjdXN0b21FbGVtZW50cy5nZXQoJ2N1c3RvbS1wcm9kdWN0LWluZm8nKSkge1xuICBjdXN0b21FbGVtZW50cy5kZWZpbmUoJ2N1c3RvbS1wcm9kdWN0LWluZm8nLCBQcm9kdWN0SW5mbyk7XG59XG4iLCIvKipcbiAqIENvcGllZCBhbmQgYWRhcHRlZCBmcm9tIFNwb3RsaWdodFxuICogQHNlZSBjb25zdGFudHMuanNcbiAqL1xuZXhwb3J0IGNvbnN0IE9OX0NIQU5HRV9ERUJPVU5DRV9USU1FUiA9IDMwMDtcblxuZXhwb3J0IGNvbnN0IFBVQl9TVUJfRVZFTlRTID0ge1xuICBjYXJ0VXBkYXRlOiAnY2FydC11cGRhdGUnLFxuICBxdWFudGl0eVVwZGF0ZTogJ3F1YW50aXR5LXVwZGF0ZScsXG4gIHZhcmlhbnRDaGFuZ2U6ICd2YXJpYW50LWNoYW5nZScsXG4gIGNhcnRFcnJvcjogJ2NhcnQtZXJyb3InLFxufTtcbiJdLCJuYW1lcyI6WyJzdWJzY3JpYmVycyIsInN1YnNjcmliZSIsImV2ZW50TmFtZSIsImNhbGxiYWNrIiwidW5kZWZpbmVkIiwiZmlsdGVyIiwiY2IiLCJQcm9kdWN0SW5mbyIsIkhUTUxFbGVtZW50IiwiY29uc3RydWN0b3IiLCJzdXBlciIsInF1YW50aXR5Rm9ybSIsImNhcnRVcGRhdGVVbnN1YnNjcmliZXIiLCJ2YXJpYW50Q2hhbmdlVW5zdWJzY3JpYmVyIiwidGhpcyIsImlucHV0IiwicXVlcnlTZWxlY3RvciIsImN1cnJlbnRWYXJpYW50Iiwic3VibWl0QnV0dG9uIiwiY29ubmVjdGVkQ2FsbGJhY2siLCJjb25zb2xlIiwibG9nIiwic2V0UXVhbnRpdHlCb3VuZHJpZXMiLCJkYXRhc2V0Iiwib3JpZ2luYWxTZWN0aW9uIiwiZmV0Y2hRdWFudGl0eVJ1bGVzIiwiYmluZCIsImV2ZW50Iiwic2VjdGlvbklkIiwic2VjdGlvbiIsImRhdGEiLCJ1cGRhdGVRdWFudGl0eVJ1bGVzIiwiaHRtbCIsImRpc2Nvbm5lY3RlZENhbGxiYWNrIiwiY2FydFF1YW50aXR5IiwicGFyc2VJbnQiLCJtaW4iLCJtYXgiLCJzdGVwIiwiTWF0aCIsInJlbW92ZUF0dHJpYnV0ZSIsInZhbHVlIiwiZm9yRWFjaCIsImNsYXNzTGlzdCIsInJlbW92ZSIsImZldGNoIiwidXJsIiwidGhlbiIsInJlc3BvbnNlIiwidGV4dCIsInJlc3BvbnNlVGV4dCIsIkRPTVBhcnNlciIsInBhcnNlRnJvbVN0cmluZyIsImNhdGNoIiwiZSIsImVycm9yIiwiZmluYWxseSIsImFkZCIsInF1YW50aXR5Rm9ybVVwZGF0ZWQiLCJnZXRFbGVtZW50QnlJZCIsInNlbGVjdG9ycyIsInNlbGVjdG9yIiwiY3VycmVudCIsInVwZGF0ZWQiLCJhdHRyaWJ1dGVzIiwiYXR0cmlidXRlIiwidmFsdWVVcGRhdGVkIiwiZ2V0QXR0cmlidXRlIiwic2V0QXR0cmlidXRlIiwiaW5uZXJIVE1MIiwiY3VzdG9tRWxlbWVudHMiLCJnZXQiLCJkZWZpbmUiXSwic291cmNlUm9vdCI6IiJ9